<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Firmware Upgrade of WINC Devices | Harmony 3 Wireless application examples for WINC3400</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Firmware Upgrade of WINC Devices" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Wireless application examples for WINC3400" /> <meta property="og:description" content="Harmony 3 Wireless application examples for WINC3400" /> <link rel="canonical" href="../../apps/getting_started/winc_firmware_upgrade.html" /> <meta property="og:url" content="../../apps/getting_started/winc_firmware_upgrade.html" /> <meta property="og:site_name" content="Harmony 3 Wireless application examples for WINC3400" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Firmware Upgrade of WINC Devices" /> <script type="application/ld+json"> {"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"@type":"WebPage","url":"../../apps/getting_started/winc_firmware_upgrade.html","headline":"Firmware Upgrade of WINC Devices","description":"Harmony 3 Wireless application examples for WINC3400","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../" class="nav-list-link">Harmony 3 Wireless application examples for WINC3400</a><ul class="nav-list "><li class="nav-list-item "><a href="../../apps/getting_started/create_winc_project_from_scratch.html" class="nav-list-link">Create WINC Project - Getting Started</a></li><li class="nav-list-item "><a href="../../apps/getting_started/winc_supported_modes.html" class="nav-list-link">Supported Network Modes in WINC</a></li><li class="nav-list-item "><a href="../../apps/ap_scan/readme.html" class="nav-list-link">AP Scan</a></li><li class="nav-list-item "><a href="../../apps/wifi_winc_sta_bypass/readme.html" class="nav-list-link">STA Bypass mode</a></li><li class="nav-list-item "><a href="../../apps/power_save_mode_example/readme.html" class="nav-list-link">Power Save Mode</a></li><li class="nav-list-item "><a href="../../apps/tcp_client/readme.html" class="nav-list-link">TCP Client</a></li><li class="nav-list-item "><a href="../../apps/wifi_tcp_server_in_softap/readme.html" class="nav-list-link">TCP Server in SoftAP</a></li><li class="nav-list-item "><a href="../../apps/wifi_socket_demos/readme.html" class="nav-list-link">Wi-Fi Socket Mode Demos</a></li><li class="nav-list-item "><a href="../../apps/wifi_bypass_demos/readme.html" class="nav-list-link">Wi-Fi Bypass Mode Demos</a></li><li class="nav-list-item "><a href="../../apps/wifi_provisioning_via_wps/readme.html" class="nav-list-link">Wifi Provisioning via WPS</a></li><li class="nav-list-item "><a href="../../apps/wifi_provision_via_ble/readme.html" class="nav-list-link">Wi-Fi provisioning using BLE</a></li><li class="nav-list-item "><a href="../../apps/wifi_provisioning_via_softap/readme.html" class="nav-list-link">Wifi Provisioning via SoftAP</a></li><li class="nav-list-item "><a href="../../apps/wifi_socket_demos/winc_same54_socketmode_from_scratch.html" class="nav-list-link">Example project creation - WINC3400+SAME54 Socket mode</a></li><li class="nav-list-item "><a href="../../apps/wifi_bypass_demos/winc3400_same54_bypassmode_from_scratch.html" class="nav-list-link">Example project creation - WINC3400+SAME54 Bypass mode</a></li><li class="nav-list-item active"><a href="../../apps/getting_started/winc_firmware_upgrade.html" class="nav-list-link active">Firmware Upgrade of WINC Devices</a></li><li class="nav-list-item "><a href="../../apps/wifi_socket_demos/winc_samd21_socketmode_from_scratch.html" class="nav-list-link">Example project creation - WINC3400+SAMD21 Socket mode</a></li></ul></li><li class="nav-list-item"><a href="../../release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="../../mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Harmony 3 Wireless application examples for WINC3400" aria-label="Search Harmony 3 Wireless application examples for WINC3400" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../">Harmony 3 Wireless application examples for WINC3400</a></li> <li class="breadcrumb-nav-list-item"><span>Firmware Upgrade of WINC Devices</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="winc-devices--integrated-serial-flash-memory-download-procedure"> <a href="#winc-devices--integrated-serial-flash-memory-download-procedure" aria-labelledby="winc-devices--integrated-serial-flash-memory-download-procedure" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> WINC Devices – Integrated Serial Flash Memory Download Procedure </h1> <p>ATWINC1500/ATWINC3400 features an on-chip microcontroller and integrated SPI Flash memory for system firmware. The serial flash memory also stores the root certificate required for TLS/SSL connection and the gain table values used by transceiver. This application note explains in detail downloading procedure of firmware, certificate, and gain values into WINC serial flash through different supported serial interfaces like UART/I2C. This document also covers some useful troubleshooting tips for downloading failures.</p> <p><strong>Features:</strong><br /></p> <ul> <li>Firmware download procedure</li> <li>Root certificate download procedure</li> <li>Gain table values download procedure</li> <li>Troubleshooting tips</li> <li>Common download procedure for WINC1500 and WINC3400</li> </ul> <h2 id="introduction"> <a href="#introduction" aria-labelledby="introduction" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction </h2> <p>The WINC1500 or WINC3400 firmware update project will be available in the path {local system path}\wireless_wifi\utilities\wifi\winc. The latest firmware update project contains the new firmware images as well as the batch script and Shell script files used to download the firmware into Wi-Fi Network Controller (WINC) through SPI/UART.</p> <h2 id="firmware-update-project"> <a href="#firmware-update-project" aria-labelledby="firmware-update-project" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Firmware update project </h2> <p>The ATWINC1500 and ATWINC3400 WiFi devices require firmware to be loaded into flash memory. The ATWINC1500 and ATWINC3400 devices are preloaded with the firmware, however it would be useful to update the latest firmware to take advantage of fixes and new features.</p> <h2 id="download-wireless-repository-from-github"> <a href="#download-wireless-repository-from-github" aria-labelledby="download-wireless-repository-from-github" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Download wireless repository from Github </h2> <p>Install MPLAB® X Integrated Development Environment (IDE). After the installation, open the MPLAB IDE and launch H3 content manager from the IDE</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/content_manager.png" alt="" /></p> <p>Please provide the framework path with the local system path.</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/content_manager_2.png" alt="" /></p> <p>This displays a new window as shown below.</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/content_manager_3.png" alt="" /></p> <p>Using this window, user can download either all the packages or only the wireless packages with its required dependencies.</p> <p>To download the wireless packages and its dependencies:<br /></p> <ul> <li>Scroll down and select <strong>wireless_wifi, wireless_apps_winc1500 and wireless_apps_winc3400</strong>.</li> <li>Click <strong>Download Selected</strong></li> </ul> <p><img src="../../apps/getting_started/images/firmware_upgrade/content_manager_4.png" alt="" /></p> <p>It requests permission to download its dependencies. Click <strong>OK</strong></p> <p><img src="../../apps/getting_started/images/firmware_upgrade/content_manager_5.png" alt="" /></p> <p>In the License Window<br /></p> <ul> <li>Select <strong>Accept All License</strong></li> <li>Click <strong>Close</strong></li> </ul> <p>Go to the local system path and check if the following packages are downloaded correctly</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/content_manager_6.png" alt="" /></p> <p>The firmware upgrade tool for WINC devices will be available in : {local system path}\wireless_wifi\utilities\wifi\winc</p> <h2 id="hardware-setup"> <a href="#hardware-setup" aria-labelledby="hardware-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hardware Setup </h2> <ul> <li>SAM D21 Xplained Pro Evaluation Kit (ATSAMD21-XPRO) - SAMD21 is used as a HostMCU</li> <li>ATWINC1500 / WINC3400 Xplained PRO Evaluation Kit (ATWINC1500-XPRO / ATWINC3400-XPRO) - Wi-Fi SPI slave device connected to SAMD21 HostMCU device</li> <li>The ATWINC1500 / ATWINC3400 device is attached to EXT1 of the SAMD21 Xplained Pro kit.</li> <li> <p>Plug a micro-USB cable from Windows computer to the debug USB port of the SAM D21 Xplained Pro Evaluation kit</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/hardware.png" alt="" /></p> </li> </ul> <h2 id="serial-bridge-application"> <a href="#serial-bridge-application" aria-labelledby="serial-bridge-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Serial Bridge Application </h2> <p>As the WINC device is connected to host MCU through SPI interface, upgrading the WINC serial flash via the host MCU would be an easier solution. Since, WINC provides transparent access to host MCU, the WINC serial flash can be read/written from host MCU. The host MCU can program the serial (SPI) flash without the need for operational firmware in the WINC. The host MCU running the serial bridge firmware is connected between computer and WINC SPI to download the firmware to WINC serial flash.<br /> <strong>winc_programmer_UART (PC) &lt;—-&gt; samd21_xplained_pro_serial_bridge.elf(Host) &lt;—-&gt; WINC SPI device</strong></p> <h3 id="serial-bridge-application-for-harmony-3"> <a href="#serial-bridge-application-for-harmony-3" aria-labelledby="serial-bridge-application-for-harmony-3" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Serial Bridge Application for Harmony 3 </h3> <ul> <li>Open MPLAB</li> <li>Go to File Menu and select Open Project</li> <li> <p>In the next window, select the Serial bridge project from {local system path}\wireless_wifi\apps\serial_bridge\firmware and click <strong>Open Project</strong></p> <p><img src="../../apps/getting_started/images/firmware_upgrade/open_project.png" alt="" /></p> </li> <li>Build the project</li> <li> <p>The click <strong>Make and Program Device</strong> button.</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/make_n_program_device.png" alt="" /></p> </li> </ul> <h3 id="hardware-setup-1"> <a href="#hardware-setup-1" aria-labelledby="hardware-setup-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hardware Setup </h3> <ul> <li>Power On Sequence <ul> <li>• To perform a serial flash download using the ATWINC1500 built-in UART, it is mandatory that the ATWINC1500 chip is in the right bootloader state.</li> <li>To do so, the HostMCU must power up the ATWINC1500 chip and then perform the reset sequence as defined in the ATWINC1500 datasheet</li> </ul> </li> <li>UART Pin Assignment <ul> <li>Pin assignment of WINC1500 module UART are described in the following table.</li> <li>On ATWINC1500 Xplained Pro, TX and RX are available on through holes labeled “DEBUG_UART” for easy identification.<br /></li> </ul> <div class="table-wrapper"><table> <thead> <tr> <th>ATWINC1500 module pin name</th> <th>ATWINC1500 Xplained Pro pin name</th> <th>Function</th> </tr> </thead> <tbody> <tr> <td>J14</td> <td>UART_TX</td> <td>TXD</td> </tr> <tr> <td>J19</td> <td>UART_RXD</td> <td>RXD</td> </tr> <tr> <td> </td> <td> </td> <td> </td> </tr> </tbody> </table></div> <p>Ensure that the HostMCU is powered up and ATWINC1500 built-in UART is connected to PC via a serial to USB converter.</p> </li> </ul> <h2 id="general-information-on-firmware-update"> <a href="#general-information-on-firmware-update" aria-labelledby="general-information-on-firmware-update" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> General Information on Firmware Update </h2> <p>The firmware upgrade tool for the WINC devices contains,</p> <ul> <li>Scripts</li> <li>Binary Tools</li> </ul> <h3 id="scripts"> <a href="#scripts" aria-labelledby="scripts" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scripts </h3> <p>The “winc” folder in <strong>{local system path}\wireless_wifi\utilities\wifi</strong> path contains the following two scripts.</p> <ol> <li> <p>winc_flash_tool.cmd<br /> This script is for the firmware upgrade in Windows and it uses the “image_tool” and “winc_programmer_uart/i2c” to build and program the firmware binary image to the WINC devices.<br /></p> <ul> <li> <p>winc_flash_tool.cmd Usage</p> <div class="table-wrapper"><table> <thead> <tr> <th>Usage</th> <th>Command Example</th> </tr> </thead> <tbody> <tr> <td>To erase the entire flash</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /e</td> </tr> <tr> <td>To create and program the Firmware Image</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /e /x /i prog /w</td> </tr> <tr> <td>To create and program the All-in-one(AIO) Image</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /e /x /i aio /w</td> </tr> <tr> <td>To create OTA Image</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /i ota</td> </tr> <tr> <td>Writing to “Root certificate” region</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /e /x /i root /w</td> </tr> <tr> <td>Writing to “HTTP files” region</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /e /x /i http /w</td> </tr> <tr> <td>To read the entire flash</td> <td>winc_flash_tool.cmd /p COM3 /d WINC3400 /v 1.4.2 /r</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th>Arguments</th> <th>Details</th> </tr> </thead> <tbody> <tr> <td>/p</td> <td>Serial port for UART mode</td> </tr> <tr> <td>/d</td> <td>WINC device type</td> </tr> <tr> <td>/s</td> <td>Aardvark serial number</td> </tr> <tr> <td>/v</td> <td>Firmware version number</td> </tr> <tr> <td>/e</td> <td>Erase entire device before programming</td> </tr> <tr> <td>/x</td> <td>Read XO offset before creating programming image</td> </tr> <tr> <td>/i</td> <td>Image type:<br />prog - Programmer format<br />aio - All in one image, raw binary<br /> ota - OTA<br />root - Root certificates in programmer format<br /> http - HTTP files in programmer formatn</td> </tr> <tr> <td>/w</td> <td>Write to device</td> </tr> <tr> <td>/f</td> <td>Filename of image file to create</td> </tr> <tr> <td>/r</td> <td>Read entire flash from device</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> </li> </ul> </li> <li> <p>winc_flash_tool.sh<br /> This script is for the firmware upgrade in Linux and it uses the “image_tool” and “winc_programmer_uart/i2c” to build and program the firmware binary image to the WINC devices.<br /></p> <ul> <li> <p>winc_flash_tool.sh Usage</p> <div class="table-wrapper"><table> <thead> <tr> <th>Usage</th> <th>Command Example</th> </tr> </thead> <tbody> <tr> <td>To erase the entire flash</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -e</td> </tr> <tr> <td>To create and program the Firmware Image</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -e -x -i prog -w</td> </tr> <tr> <td>To create and program the All-in-one(AIO) Image</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -e -x i aio -w</td> </tr> <tr> <td>To create OTA Image</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -i ota</td> </tr> <tr> <td>Writing to “Root certificate” region</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -e -x -i root -w</td> </tr> <tr> <td>Writing to “HTTP files” region</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -e -x -i http -w</td> </tr> <tr> <td>To read the entire flash</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -r</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th>Arguments</th> <th>Details</th> </tr> </thead> <tbody> <tr> <td>-p</td> <td>Serial port for UART mode</td> </tr> <tr> <td>-d</td> <td>WINC device type</td> </tr> <tr> <td>-s</td> <td>Aardvark serial number</td> </tr> <tr> <td>-v</td> <td>Firmware version number</td> </tr> <tr> <td>-e</td> <td>Erase entire device before programming</td> </tr> <tr> <td>-x</td> <td>Read XO offset before creating programming image</td> </tr> <tr> <td>-i</td> <td>Image type:<br />prog - Programmer format<br />aio - All in one image, raw binary<br /> ota - OTA<br />root - Root certificates in programmer format<br /> http - HTTP files in programmer formatn</td> </tr> <tr> <td>-w</td> <td>Write to device</td> </tr> <tr> <td>-f</td> <td>Filename of image file to create</td> </tr> <tr> <td>-r</td> <td>Read entire flash from device</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> </li> </ul> </li> </ol> <h3 id="atwinc1500atwinc3400-binary-tools"> <a href="#atwinc1500atwinc3400-binary-tools" aria-labelledby="atwinc1500atwinc3400-binary-tools" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ATWINC1500/ATWINC3400 Binary Tools </h3> <p>The script files internally use the following tools to build and program the image.</p> <ol> <li>image_tool - Builds firmware binary image</li> <li>winc_programmer_uart/i2c – Program the built firmware binary image to the WINC device using UART or I2C interface.</li> </ol> <h4 id="building-firmware-image"> <a href="#building-firmware-image" aria-labelledby="building-firmware-image" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Building Firmware Image </h4> <ul> <li>image_tool located in <strong>{local system path}\wireless_wifi\utilities\wifi\winc\tools</strong> is used to build binary images for ATWINC devices.</li> <li>It collects all the binaries for each section and combine it in to one firmware called wincXXXX_X.X.X.bin.</li> <li>The image_tool arrange the section according to the flash memory orgianization of ATWINC1500/ATWINC3400</li> <li>The image_tool collects the information from the flash_image XML file.</li> <li>Refer flash_image.config XML for how the flash memory is divided.</li> <li>User needs to update the flash_image.config for updating the root certificate or adding custom provisioning pages</li> <li>The configuration XML file(flash_image.config) can be found under <strong>{local system path}wireless_wifi\utilities\wifi\winc\files\wincXXXX\X.X.X</strong> directory</li> </ul> <h4 id="image_tool-usage"> <a href="#image_tool-usage" aria-labelledby="image_tool-usage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> image_tool Usage </h4> <div class="table-wrapper"><table> <thead> <tr> <th>Usage</th> <th>Command Example</th> </tr> </thead> <tbody> <tr> <td>To create firmware image</td> <td>image_tool.exe -c 1.4.2\flash_image.config -c gain_tables\gain.config -o winc3400_1.4.2.bin -of prog</td> </tr> <tr> <td>Writing to a specific region(eg: Root certificate)</td> <td>image_tool.exe -c 1.4.2\flash_image.config -c gain_tables\gain.config winc3400_1.4.2.bin -of prog -r “root certificates”</td> </tr> <tr> <td>To create OTA firmware image</td> <td>image_tool.exe -c 1.4.2\flash_image.config -o winc3400_1.4.2.bin -of winc_ota -s ota</td> </tr> <tr> <td>To create OTA Image</td> <td>winc_flash_tool.cmd -p TTYS0 -d WINC3400 -v 1.4.2 -i ota</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th>Arguments</th> <th>Details</th> </tr> </thead> <tbody> <tr> <td>-c</td> <td>Configuration files Microchip recommends to use the default configuration files which is flash_image.config</td> </tr> <tr> <td>-o</td> <td>Output name of the binary image files ATWINC1500: winc1500_X.X.X.bin &lt;/br&gt; ATWINC3400: winc3400_X.X.X.bin</td> </tr> <tr> <td>-of</td> <td>The image_tool supports 4 output formats<br /> raw - Raw binary image. <br />winc_ota - WINC OTA format.<br />prog - Format suitable for programming.<br />log - Textual log information</td> </tr> <tr> <td>-r</td> <td>Firmware version number</td> </tr> <tr> <td>-e</td> <td>Erase entire device before programming</td> </tr> <tr> <td>-x</td> <td>Read XO offset before creating programming image</td> </tr> <tr> <td>-i</td> <td>Image type:<br />prog - Programmer format<br />aio - All in one image, raw binary<br /> ota - OTA<br />root - Root certificates in programmer format<br /> http - HTTP files in programmer formatn</td> </tr> <tr> <td>-w</td> <td>Specifies a region to process.More than one region can be specified with repeated use of this option. If used only the regions specified will be processed.</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> <p>For more information, enter image_tool help command:image_tool -h</p> <h4 id="commands-logs"> <a href="#commands-logs" aria-labelledby="commands-logs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commands Logs </h4> <ul> <li>Creating Firmware Image</li> </ul> <p>Expected output log for the command: <br /> image_tool.exe -c 1.4.2\flash_image.config -c gain_tables\gain.config -o winc3400_1.4.2.bin -of prog</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/imagetool_1.png" alt="" /></p> <ul> <li>Writing to a Specific Region</li> </ul> <p>Expected output log for the command:<br /></p> <p>image_tool.exe -c 1.4.2\flash_image.config -c gain_tables\gain.config winc3400_1.4.2.bin -of prog -r “root certificates”</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/imagetool_2.png" alt="" /></p> <ul> <li>Creating OTA Firmware Image</li> </ul> <p>Expected output log for the command:</p> <p>image_tool.exe -c 1.4.2\flash_image.config -o winc3400_1.4.2.bin -of winc_ota -s ota</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/imagetool_3.png" alt="" /></p> <h4 id="programming-firmware-image"> <a href="#programming-firmware-image" aria-labelledby="programming-firmware-image" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Programming Firmware Image </h4> <p>winc_programmer_uart/i2c tool located in src/firmware/firmware is used to program the binary images for ATWINC1500/ATWINC3400 devices using UART or I2C interface. it does the following primary jobs:</p> <ul> <li>Erase the ATWINC1500/ATWINC3400 memory</li> <li>Read the firmware from ATWINC1500/ATWINC3400</li> <li>Write the firmware to ATWINC1500/ATWINC3400</li> <li>Verify the written firmware.</li> </ul> <h4 id="winc_programmer_uart-tool-usage"> <a href="#winc_programmer_uart-tool-usage" aria-labelledby="winc_programmer_uart-tool-usage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> winc_programmer_uart Tool Usage </h4> <div class="table-wrapper"><table> <thead> <tr> <th>Usage</th> <th>Command Example</th> </tr> </thead> <tbody> <tr> <td>Erase ATWINC1500/ATWINC3400 flash memory</td> <td>winc_programmer_uart.exe -p COM16 -d winc3400 -e -pfw 1.4.2\firmware\programmer_firmware.bin</td> </tr> <tr> <td>Write the created binary image to ATWINC1500/ATWINC3400 flash memory</td> <td>winc_programmer_uart.exe -p COM16 -d winc3400 -i winc3400_1.4.2.bin -if prog -w -pfw 1.4.2\firmware\programmer_firmware.bin</td> </tr> <tr> <td>Verify the written image in ATWINC1500/ATWINC3400 device</td> <td>winc_programmer_uart.exe -p COM16 -d winc3400 -i winc3400_1.4.2.bin -if prog -r -pfw 1.4.2\firmware\programmer_firmware.bin</td> </tr> <tr> <td>Single command (including all the above operations)</td> <td>winc_programmer_UART.exe -p COM16 -d winc3400 -e -i winc3400_1.4.2.bin -if prog -w -r -pfw 1.4.2\firmware\programmer_firmware.bin</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th>Arguments</th> <th>Details</th> </tr> </thead> <tbody> <tr> <td>-p</td> <td>Port number of the connected HostMCU COM Port Command to find the Port number: test_edbg</td> </tr> <tr> <td>-d</td> <td>ATWINC device: winc1500 or winc3400</td> </tr> <tr> <td>-e</td> <td>To erase the ATWINC1500/ATWINC3400 device flash memory before writing the firmware image</td> </tr> <tr> <td>-w</td> <td>To write the firmware image</td> </tr> <tr> <td>-r</td> <td>To read the firmware image</td> </tr> <tr> <td>-if</td> <td>Input format.<br /> winc_ota - WINC OTA format.<br />raw - A raw binary image.<br />prog - Format suitable for programming.</td> </tr> <tr> <td>-pfw</td> <td>programming firmware : <br />WINC firmware used to program the device.</td> </tr> <tr> <td> </td> <td> </td> </tr> </tbody> </table></div> <p>For more information enter winc_programmer_uart help command:<br /> <em>winc_programmer_uart.exe -h</em></p> <h4 id="commands-logs-1"> <a href="#commands-logs-1" aria-labelledby="commands-logs-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commands logs </h4> <ol> <li> <p>Erase WINC memory <br /></p> <p>Expected output log for the command: <br /> winc_programmer_uart.exe -p COM16 -d winc3400 -e -pfw 1.4.2\firmware\programmer_firmware.bin</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/erase.png" alt="" /></p> </li> <li> <p>Write Firmware Image to WINC <br /> Expected output log for the command:<br /></p> <p>winc_programmer_uart.exe -p COM16 -d winc3400 -i winc3400_1.4.2.bin -if prog -w -pfw 1.4.2\firmware\programmer_firmware.bin</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/write_firmware.png" alt="" /></p> </li> <li> <p>Read Firmware Image from WINC memory <br /> Expected output log for the Command: <br /></p> <p>winc_programmer_uart.exe -p COM16 -d winc3400 -r -pfw 1.4.2\firmware\programmer_firmware.bin</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/read_firmware.png" alt="" /></p> </li> <li> <p>Verify the Written Image <br /> Expected output log for the command:</p> <p>winc_programmer_uart.exe -p COM16 -d winc3400 -i winc3400_1.4.2.bin -if prog -r -pfw 1.4.2\firmware\programmer_firmware.bin</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/verify.png" alt="" /></p> </li> <li> <p>Consolidated Single Command <br /> This command does all the all the above operations in a single command. <br /> Expected output log for the command:</p> <p>winc_programmer_UART.exe -p COM16 -d winc3400 -e -i winc3400_1.4.2.bin -if prog -w -r -pfw 1.4.2\firmware\programmer_firmware.bin</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/consolidated.png" alt="" /></p> </li> </ol> <h3 id="download-failure-troubleshooting"> <a href="#download-failure-troubleshooting" aria-labelledby="download-failure-troubleshooting" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Download Failure Troubleshooting </h3> <p>Here are the troubleshooting tips for a specific error while downloading using batch script.</p> <ol> <li> <p>The script Failed To Find Any COM Port<br /> The winc_programmer_uart.exe expects a COM port as an argument. If the expected COM port is not found, then it will provide the below error.</p> <p><img src="../../apps/getting_started/images/firmware_upgrade/com_port_failed.png" alt="" /></p> <p><strong>How to fix it:</strong><br /></p> <ul> <li>Make sure ATWINC1500/ATWINC3400 COM port is listed in the device manager.</li> <li>Make sure ATWINC1500/ATWINC3400 COM port is not opened by any other application. For verification, try to open and close the COM port with a terminal application.</li> <li>low quality USB cable or low quality serial to USB converter (built-in UART) can introduce garbage on the UART line thus failing the detection of the ATWINC1500/ATWINC3400 COM port. Try a different cable.</li> <li>When performing a “built-in UART download”, it is expected that the ATWINC1500/ATWINC3400 bootloader is in a particular state that can only be achieved after doing a clean power up and reset sequence. Hence, before doing a download always ensure that a clean power up and reset sequence has been made.</li> <li>Make sure that no other extension board (ex: IO1…) is connected to the Xplained Pro board while performing the download.</li> <li>Make sure the project path is not exceeding Windows maximum 260 characters path length.</li> </ul> </li> <li> <p>Failed To Initialize Programmer: Invalid Chip ID</p> <p>The Failed to initialize programmer with Invalid chip ID error typically happens when there is garbage or noise on the UART line preventing from reading the correct chip ID value. How to fix it:</p> <ul> <li>Try connecting the PC and the ATWINC1500/ATWINC3400 with a different cable. A clean power up and reset sequence of the ATWINC1500/ATWINC3400 is necessary to start over with the ATWINC1500/ATWINC3400 bootloader in the appropriate state.</li> </ul> </li> <li> <p>Failed To Initialize Programmer: Waiting For Chip Permission</p> <p>After printing the correct chip ID of the ATWINC1500/ATWINC3400, the winc_programmer_UART tool programs a small binary (programmer firmware) to assist with ATWINC1500/ATWINC3400 flash programming. At this stage the winc_programmer_UART will change the UART baud rate from 115200 to 500000 to speed up the actual transfer of the firmware image. Once the baud rate change is made, the chip permission is verified to ensure the UART connection is reliable. Failing at this stage means that the current setup does not support such a high baud rate. <br /> How to fix it:<br /></p> <ul> <li>It is recommended to try connecting the PC and the ATWINC1500/ATWINC3400 with a different cable. Also a clean power up and reset sequence of the ATWINC1500/ATWINC3400 is necessary to start over with the ATWINC1500/ATWINC3400 bootloader in the appropriate state.</li> </ul> </li> </ol> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2021 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
